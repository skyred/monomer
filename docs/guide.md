# Guide to Building Drupal Themes with Web Components (Polymer based)

## Table of contents
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->


- [Why Web Components? Why Polymer?](#why-web-components-why-polymer)
- [Real life examples](#real-life-examples)
- [Wrapper elements vs. Blackbox elements](#wrapper-elements-vs-blackbox-elements)
- [Installing dependencies via Bower](#installing-dependencies-via-bower)
- [Creating Polymer element and using it in Twig templates](#creating-polymer-element-and-using-it-in-twig-templates)
- [How to use/extend the Monomer base theme](#how-to-useextend-the-monomer-base-theme)
  - [1. Override the style module](#1-override-the-style-module)
  - [2. Override the element](#2-override-the-element)
  - [3. Override Twig templates](#3-override-twig-templates)
- [CSS styling](#css-styling)
  - [Style module](#style-module)
  - [CSS selectors for Web Components](#css-selectors-for-web-components)
    - [1. :host and :host-context](#1-host-and-host-context)
    - [2.  ::content](#2--content)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Why Web Components? Why Polymer?
 - Encapsulation: Web Components are bundled with CSS and JS. This makes them easy to "carry around" and put into different sites without having to worry about referencing the proper files or contaminating the page.
 - Behaviours included: with libraries like Polymer you can easily built interactive page elements such as collapsible menus and slideshows. Traditionally, we need to load additional JS files to achieve that. With Web Components, the JS code is still there, but sealed inside the component as if a black box.  
 - Cleaner markup: instead of having a lot of wrapper elements (<div>s and <span>s), putting them in Web Components makes the markup of the page cleaner and more semantic.
 - Save time: Take advantage of already made elements on (Polymer Catalog)[https://elements.polymer-project.org/], [Custom Elements](https://customelements.io/) or [Vaadin Elements](https://vaadin.com/elements).
 
Polymer is just one of the libraries based on Web Components. Currently, it is the one that is most widely used in production.

## Real life examples

 - One website that uses Polymer elements in production is [ea.com](http://www.ea.com/). Inspect the site, view its source code and you will find tags like `<ea-hero>`, `<ea-section>` etc. 
   If you are technical, you may also dig into the [source code](http://pl.ea.com/branch/ea-play-stable-3/elements/ea-elements.html) of their elements.

 - [Google Project Fi website](https://fi.google.com/about/) uses some Polymer elements, primarily in the navbar.

 - [Braid.io](https://braid.io/)

> Note: We are talking about using Web Components in (traditional) website designs, NOT single-page web apps. Although the boundary between websites and web apps could be blurred, 
> a key difference is that web apps have all UI-logic done client-side, whereas websites (like those powered by Drupal, WordPress, etc.) relies on the server to generate each page and respond to user interactions.
> 
> In the case of a website, although Web Components can be used to provide some UI enhancements (e.g. encapsulated styling, animations, simple interactions), key behaviours (especially those related to state changes, like page navigations and form submissions) are done by the server. 
>
> This means we are using Web Components to enhance the experience of traditional websites, and they are NOT meant to be replacement of web apps.

## Wrapper elements vs. Blackbox elements

 - **Blackbox elements** are those that encapsulate everything, including styling and behaviours, and only provide a few simple arguments for input. 
 Examples include video player, responsive image, "fancy button" etc. 
 
 - **Wrapper elements** are those that provides acts as a wrapper of content output by other parts of the system. For example, a "region" element in Drupal might
 contain any content generated by Drupal, including nodes and blocks. Such nature means that wrapper elements cannot have too much assumption about what 
 it will contain and need to be universal, which limits what they can encapsulate. However, wrapper elements can still encapsulate styling and the "wrapping part" 
 (e.g. border and padding). In practice, wrapper elements are often used with LightDOM children, `<content>` and/or [`<slot>`](https://webkit.org/blog/4096/introducing-shadow-dom-api/) to form a composed DOM.

> Note: according to latest spec, `<content>` element is [being deprecated](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/content) in favor of `<slot>`. However, Polymer still uses `<content>` and there is no clear documentation about `<slot>`.
>
> For the time being we will use `<content>` but need to watch closely at updates in Polymer.

Although in a web app, it is ideal to build blackbox elements; in designing a Drupal theme, it is more common that you would work with wrapper elements.

## Installing dependencies via Bower

```bash
> bower install --save your-element
```

## Creating Polymer element and using it in Twig templates
`my-element/mm-region/mm-region.html`:
```html
<link rel="import" href="../polymer/polymer.html">  <!-- Always use "canonical url"-->
<dom-module id="mm-region">
  <template>
    <style>
      /* Put CSS here */
    </style>
    <content></content>
  </template>
<script>
  Polymer({
    is: 'mm-region',
    properties: { // Data attributes / argument
      name: String,
      hidden: {
        type: Boolean,
        value: false,
      }
    },
    ready: function () {
      // JavaScript code to run when the element is ready (loaded on the page).
    }
  });
</script>
</dom-module>
```

>  Note: always use relative URL like "../package-name/element-name.html" in your Polymer elements. Do NOT put "bower_components/" or "my-elements/" in the path.

> Tip: If you have Drupal Console installed, you can use the command drupal polymer:element to generate the boilerplate code for your Polymer element.

See also: [Element project layout](https://www.polymer-project.org/1.0/docs/tools/polymer-cli#element-project-layout) | [Local DOM](https://www.polymer-project.org/1.0/start/first-element/step-2) | [Lifecycle callbacks](https://www.polymer-project.org/1.0/docs/devguide/registering-elements#lifecycle-callbacks)

In your Twig template (where you want to put your element), use the following:
```twig
{% polymer import 'mm-region/mm-region.html' %}  {# this will add a <link> to the page #}
<mm-region{{ attributes }}
          {{ !active ? 'hidden="true"' }}        {# Tip: do not put a conditional attribute as the last attribute #}
          name="{{ name ]}">
{{ content }} 
</mm-region>
```

## How to use/extend the Monomer base theme

To use Monomer, you need to create a subtheme that has `monomer` as the base theme. There are three levels of customizations that you can do, 
depending on your need.

### 1. Override the style module 
Most [pre-built Polymer elements](prebuilt-elements.md) in Monomer has a style module (filename ending with `-styles.html`) which contains the CSS rules for the element. You can choose
to override a style module by creating a filename with the same name and under the same package folder in the `/my-elements` folder of your theme. 

For example, to style a region, copy `monomer/my-elements/mm-region/mm-region-styles.html` to `yourtheme/my-elements/mm-region/mm-region-styles.html`. The `mm-region-styles.html` in your
theme will be served instead of the one in Monomer.

See also: [Tutorial: Styling buttons](tutorial-button.md)

### 2. Override the element
If you need to customize the **DOM template** of an element or add new behaviours. Similar to above.

### 3. Override Twig templates
Sometimes override an element is not enough. For example, if you want to use different elements for different regions on the page, then you need to create Twig templates like `region--header.html.twig`
 and `region--footer.html.twig`. This is the same as how you would do in a normal Drupal 8 theme. You can look at the [Twig templates](../templates) in Monomer to gain some insights.

See also: [Tutorial: Building a simple studio site](tutorial.md)

## CSS styling
### Style module
To simply code and to reuse styling, you may put CSS in a seperate element called "style module" and reference it in your main element.

`my-element/mm-region/mm-region-styles.html`:
```html
<link rel="import" href="../polymer/polymer.html">
<dom-module id="mm-region-styles">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
  </template>
</dom-module>
```

`my-element/mm-region/mm-region.html`:
```html
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="mm-region-styles.html">

<dom-module id="mm-region">
  <template>
    <style include="mm-region-styles"></style>
    ...
  </template>
...
</dom-module>

```

See also: [Shared style](https://www.polymer-project.org/1.0/docs/devguide/styling#style-modules)

### CSS selectors for Web Components
There are some special selectors for styling Web Components and their children. These selectors are what allows us to encapsulate 
styling inside an element.

#### 1. :host and :host-context
  `:host` refers to the element itself.
```css
  :host {
    display: block; 
    background: #fff;
  }
  
  :host([hidden]) {
    display: none;
  } 
  /* This matches elements like: <mm-region hidden> </mm-region> */
```
  > Tip: Web Components are by default `inline`. However in designing a theme, most of the time we need `block`. 
  So, remember to write `display: block` in `:host`. 
  
  `host-context` matches whatever class/id/attributes on the element or its parent(s):
```css
  :host-context(.main-content) {
    display: block;
    font-size: 2em;
  }
  /* This matches elements like:
    <div class="main-content">
      <mm-region>
      </mm-region>
    </div>
  */
```  
#### 2.  ::content
  Select **LightDOM children** of an element. Example:
```css
  ::content #header{
    background: green;
  }
  
  /**
  This matches:
  <mm-region>
    <div id="header">Title</div> <!--Matched element-->
  </mm-region>
  **/
```

 > Note: In native ShadowDOM ::content works. However, Polymer's ShadyDOM (polyfill implementation) requires that
  "you must have a selector to the left of the ::content pseudo-element".
  
 > For compatibility, a workaround is to multiple selectors:
   ```css
     :host::content #header,
     ::content #header {
       ...
     }
   ```
 > See more at [Polymer Documentation](https://www.polymer-project.org/1.0/docs/devguide/styling#styling-distributed-children-content).

See also: [ShadowDOM CSS cheat sheet](http://robdodson.me/shadow-dom-css-cheat-sheet/)

